# ๐ ะงัะพ ัะฐะบะพะต CORS ะฟัะพัััะผะธ ัะปะพะฒะฐะผะธ

## ๐ ะะฟัะตะดะตะปะตะฝะธะต

**CORS** = Cross-Origin Resource Sharing (ะกะพะฒะผะตััะฝะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ ะผะตะถะดั ะธััะพัะฝะธะบะฐะผะธ)

ะญัะพ ะผะตัะฐะฝะธะทะผ ะฑะตะทะพะฟะฐัะฝะพััะธ ะฒ ะฑัะฐัะทะตัะฐั ะธ ะฟัะธะปะพะถะตะฝะธัั, ะบะพัะพััะน ะบะพะฝััะพะปะธััะตั ะดะพัััะฟ ะบ ัะตััััะฐะผ ั ะดััะณะธั ะดะพะผะตะฝะพะฒ.

---

## ๐ฏ ะัะพััะฐั ะฐะฝะฐะปะพะณะธั

ะัะตะดััะฐะฒััะต:
- ะะฐั ะดะพะผ = ะะฐั ัะฐะนั/ะฟัะธะปะพะถะตะฝะธะต (ะฝะฐะฟัะธะผะตั, Figma ะฟะปะฐะณะธะฝ)
- ะกะพัะตะดะฝะธะน ะดะพะผ = ะััะณะพะน ัะฐะนั (ะฝะฐะฟัะธะผะตั, avatars.mds.yandex.net)
- ะะตััััั = ะะทะพะฑัะฐะถะตะฝะธั, ะดะฐะฝะฝัะต, ัะฐะนะปั

### ะะตะท CORS (ะทะฐะฟัะตัะตะฝะพ):
```
ะั: "ะญะน, ัะพัะตะด, ะดะฐะน ะผะฝะต ัะฒะพั ะบะฐััะธะฝะบั!"
ะกะพัะตะด: "ะะตั, ัั ััะถะพะน!" โ
```

### ะก CORS (ัะฐะทัะตัะตะฝะพ):
```
ะั: "ะญะน, ัะพัะตะด, ะดะฐะน ะผะฝะต ัะฒะพั ะบะฐััะธะฝะบั!"
ะกะพัะตะด: "ะะฐ, ั ัะฐะทัะตัะฐั! ะะตัะถะธ!" โ
```

---

## ๐ ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั ะฒ ะธะฝัะตัะฝะตัะต

### ะัะธะผะตั 1: ะะฐะณััะทะบะฐ ะธะทะพะฑัะฐะถะตะฝะธั

#### ะกะธััะฐัะธั:
- ะะฐั ะฟะปะฐะณะธะฝ ัะฐะฑะพัะฐะตั ะฝะฐ `figma.com`
- ะะทะพะฑัะฐะถะตะฝะธะต ะฝะฐัะพะดะธััั ะฝะฐ `avatars.mds.yandex.net`

#### ะะฐะฟัะพั ะพั ะฟะปะฐะณะธะฝะฐ:
```http
GET /image.jpg HTTP/1.1
Host: avatars.mds.yandex.net
Origin: figma.com              โ "ะฏ ั figma.com"
```

#### ะัะฒะตั ัะตัะฒะตัะฐ ะะะ CORS:
```http
HTTP/1.1 200 OK
Content-Type: image/jpeg

[ะธะทะพะฑัะฐะถะตะฝะธะต]
```

**ะะตะทัะปััะฐั:** โ ะัะฐัะทะตั ะฑะปะพะบะธััะตั! "CORS policy: No 'Access-Control-Allow-Origin' header"

---

#### ะัะฒะตั ัะตัะฒะตัะฐ ะก CORS:
```http
HTTP/1.1 200 OK
Content-Type: image/jpeg
Access-Control-Allow-Origin: *    โ "ะะฐะทัะตัะฐั ะะกะะ!"

[ะธะทะพะฑัะฐะถะตะฝะธะต]
```

**ะะตะทัะปััะฐั:** โ ะะฐะฑะพัะฐะตั! ะะทะพะฑัะฐะถะตะฝะธะต ะทะฐะณััะถะตะฝะพ.

---

## ๐ ะ ะฝะฐัะตะผ ัะปััะฐะต (MDS SnapFill)

### ะัะพะฑะปะตะผะฐ, ะบะพัะพััั ะผั ะธะทะฝะฐัะฐะปัะฝะพ ะพะถะธะดะฐะปะธ:

```
โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Figma Plugin     โ โโโโโ   โ avatars.mds.yandex.net  โ
โ (ะฝะฐั ะฟะปะฐะณะธะฝ)     โ         โ (ะธะทะพะฑัะฐะถะตะฝะธั)           โ
โโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                        โ
                          ะะถะธะดะฐะปะธ: โ CORS ะพัะธะฑะบะฐ
                          ะะตะฐะปัะฝะพััั: โ CORS ะฒะบะปััะตะฝ!
```

### ะงัะพ ะผั ะพะฑะฝะฐััะถะธะปะธ:

```bash
$ curl -I https://avatars.mds.yandex.net/.../image.jpg

HTTP/2 200
Access-Control-Allow-Origin: *          โ ะะฐะทัะตัะฐะตั ะะกะะ!
Access-Control-Allow-Credentials: true  โ ะะพะดะดะตัะถะธะฒะฐะตั credentials
```

**ะัะฒะพะด:** ะฏะฝะดะตะบั CDN ะฃะะ ะฝะฐัััะพะตะฝ ะฟัะฐะฒะธะปัะฝะพ! CORS ะฒะบะปััะตะฝ! ๐

---

## ๐ก๏ธ ะะฐัะตะผ ะฝัะถะตะฝ CORS?

### ะะตะทะพะฟะฐัะฝะพััั!

ะัะตะดััะฐะฒััะต ััะตะฝะฐัะธะน ะะะ CORS:

```javascript
// ะะปะพะฝะฐะผะตัะตะฝะฝัะน ัะฐะนั evil.com
fetch('https://bank.com/api/transfer-money', {
  method: 'POST',
  body: JSON.stringify({
    to: 'attacker@evil.com',
    amount: 1000000
  })
});
```

ะัะปะธ ะฑั ะฝะต ะฑัะปะพ CORS:
- โ ะัะฑะพะน ัะฐะนั ะผะพะณ ะฑั ะพัะฟัะฐะฒะปััั ะทะฐะฟัะพัั ะพั ะฒะฐัะตะณะพ ะธะผะตะฝะธ
- โ ะัะฐััั ะดะฐะฝะฝัะต ะธะท ะดััะณะธั ัะฐะนัะพะฒ
- โ ะัะฟะพะปะฝััั ะดะตะนััะฒะธั ะฑะตะท ะฒะฐัะตะณะพ ะฒะตะดะพะผะฐ

ะก CORS:
- โ ะขะพะปัะบะพ ัะฐะทัะตัะตะฝะฝัะต ัะฐะนัั ะผะพะณัั ะดะตะปะฐัั ะทะฐะฟัะพัั
- โ ะกะตัะฒะตั ะบะพะฝััะพะปะธััะตั, ะบัะพ ะผะพะถะตั ะฟะพะปััะธัั ะดะพัััะฟ
- โ ะะฐัะธ ะดะฐะฝะฝัะต ะทะฐัะธัะตะฝั

---

## ๐ ะขะธะฟั CORS ัะฐะทัะตัะตะฝะธะน

### 1. ะะฐะทัะตัะธัั ะฒัะตะผ (ะฟัะฑะปะธัะฝัะต ัะตััััั):
```http
Access-Control-Allow-Origin: *
```
**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:** ะะทะพะฑัะฐะถะตะฝะธั, ะฟัะฑะปะธัะฝัะต API, CDN

**ะัะธะผะตั:** ะฏะฝะดะตะบั CDN ั ะธะทะพะฑัะฐะถะตะฝะธัะผะธ ัะพะฒะฐัะพะฒ โ

---

### 2. ะะฐะทัะตัะธัั ะบะพะฝะบัะตัะฝะพะผั ะดะพะผะตะฝั:
```http
Access-Control-Allow-Origin: https://figma.com
```
**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:** ะัะธะฒะฐัะฝัะต API, ะทะฐัะธัะตะฝะฝัะต ัะตััััั

**ะัะธะผะตั:** API ะฑะฐะฝะบะฐ, ะปะธัะฝัะต ะดะฐะฝะฝัะต ๐

---

### 3. ะะฐะทัะตัะธัั ะฝะตัะบะพะปัะบะพ ะดะพะผะตะฝะพะฒ:
```http
# ะกะตัะฒะตั ะฟัะพะฒะตััะตั ะดะพะผะตะฝ ะธ ะฒะพะทะฒัะฐัะฐะตั ัะพะพัะฒะตัััะฒัััะธะน
Access-Control-Allow-Origin: https://figma.com
# ะธะปะธ
Access-Control-Allow-Origin: https://app.example.com
```

---

## ๐ CORS Proxy โ ััะพ ััะพ?

### ะัะพะฑะปะตะผะฐ:
```
Figma Plugin โโโโโโ oldcdn.com (ะฑะตะท CORS)
```

### ะะตัะตะฝะธะต: Proxy ัะตัะฒะตั
```
Figma Plugin โโโโโโ corsproxy.io โโโโโโ oldcdn.com
                     โ
                     ะะพะฑะฐะฒะปัะตั CORS ะทะฐะณะพะปะพะฒะบะธ
```

### ะะฐะบ ัะฐะฑะพัะฐะตั CORS Proxy:

```javascript
// 1. ะะปะฐะณะธะฝ ะพัะฟัะฐะฒะปัะตั ะทะฐะฟัะพั ะฝะฐ proxy
fetch('https://corsproxy.io/?url=http://oldcdn.com/image.jpg')

// 2. Proxy ัะบะฐัะธะฒะฐะตั ะธะทะพะฑัะฐะถะตะฝะธะต ั oldcdn.com
// 3. Proxy ะดะพะฑะฐะฒะปัะตั CORS ะทะฐะณะพะปะพะฒะบะธ
// 4. Proxy ะฒะพะทะฒัะฐัะฐะตั ะธะทะพะฑัะฐะถะตะฝะธะต ั CORS
```

### ะัะพะฑะปะตะผั ั CORS Proxy:

- โ๏ธ ะะฐะฒะธัะธะผะพััั ะพั ะฒะฝะตัะฝะตะณะพ ัะตัะฒะธัะฐ
- โ๏ธ ะะพะถะตั ะฑััั ะผะตะดะปะตะฝะฝัะผ (~2-3 ัะตะบัะฝะดั)
- โ๏ธ ะะพะถะตั ะฑััั ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ (ะบะฐะบ corsproxy.io ะฒ ะะพััะธะธ)
- โ๏ธ ะะตั ะณะฐัะฐะฝัะธะน ะดะพัััะฟะฝะพััะธ

---

## ๐ ะะพัะตะผั ะฏะฝะดะตะบั CDN ัะฐะฑะพัะฐะตั ะฑะตะท proxy?

### ะฏะฝะดะตะบั CDN ะฝะฐัััะพะตะฝ ะฟัะฐะฒะธะปัะฝะพ:

```http
HTTP/2 200
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true
Content-Type: image/jpeg
```

ะญัะพ ะทะฝะฐัะธั:
1. โ ะฏะฝะดะตะบั ัะฐะทัะตัะฐะตั ะทะฐะณััะทะบั ั ะปัะฑัั ะดะพะผะตะฝะพะฒ
2. โ Figma ะผะพะถะตั ะฝะฐะฟััะผัั ะทะฐะณััะถะฐัั ะธะทะพะฑัะฐะถะตะฝะธั
3. โ ะะธะบะฐะบะพะน proxy ะฝะต ะฝัะถะตะฝ
4. โ ะััััะพ ะธ ะฝะฐะดะตะถะฝะพ

### ะััะณะธะต CDN ั CORS:

| CDN | CORS | ะกะบะพัะพััั |
|-----|------|----------|
| **ะฏะฝะดะตะบั (avatars.mds.yandex.net)** | โ ะะฐ | ะัะปะธัะฝะพ |
| **Imgur (i.imgur.com)** | โ ะะฐ | ะัะปะธัะฝะพ |
| **Cloudinary** | โ ะะฐ | ะัะปะธัะฝะพ |
| **Unsplash** | โ ะะฐ | ะัะปะธัะฝะพ |

---

## ๐๏ธ ะะฐะบ ะฝะฐัััะพะธัั CORS ะฝะฐ ัะฒะพะตะผ ัะตัะฒะตัะต

### Nginx:
```nginx
location /images/ {
    add_header 'Access-Control-Allow-Origin' '*';
    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';
    add_header 'Access-Control-Allow-Headers' 'Content-Type';
}
```

### Node.js (Express):
```javascript
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET, OPTIONS');
  next();
});
```

### Apache:
```apache
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
</IfModule>
```

---

## ๐งช ะะฐะบ ะฟัะพะฒะตัะธัั CORS?

### 1. ะงะตัะตะท curl (ะบะพะผะฐะฝะดะฝะฐั ัััะพะบะฐ):
```bash
curl -I https://avatars.mds.yandex.net/image.jpg

# ะัะธัะต ััั ัััะพะบั:
# Access-Control-Allow-Origin: *
```

### 2. ะงะตัะตะท ะฑัะฐัะทะตั (ะบะพะฝัะพะปั):
```javascript
fetch('https://avatars.mds.yandex.net/image.jpg')
  .then(response => console.log('โ CORS ัะฐะฑะพัะฐะตั!'))
  .catch(error => console.log('โ CORS ะพัะธะฑะบะฐ:', error));
```

### 3. ะงะตัะตะท ะพะฝะปะฐะนะฝ ะธะฝััััะผะตะฝั:
- [test-cors.org](https://test-cors.org)
- Chrome DevTools โ Network โ Headers

---

## โ ะงะฐัััะต ะฒะพะฟัะพัั

### Q: ะะพัะตะผั CORS ัะฐะฑะพัะฐะตั ะปะพะบะฐะปัะฝะพ, ะฝะพ ะฝะต ะฒ production?

**A:** Development ะฟะปะฐะณะธะฝั ัะฐััะพ ะธะณะฝะพัะธัััั CORS, ะฐ production โ ะฝะตั.

### Q: ะะพะถะฝะพ ะปะธ ะพัะบะปััะธัั CORS?

**A:** ะ ะฑัะฐัะทะตัะฐั โ ะฝะตั (ะฑะตะทะพะฟะฐัะฝะพััั). ะะฐ ัะตัะฒะตัะต โ ะดะฐ, ะฝะพ ะฝะต ัะตะบะพะผะตะฝะดัะตััั.

### Q: CORS = ะฑะตะทะพะฟะฐัะฝะพััั?

**A:** ะงะฐััะธัะฝะพ. CORS ะทะฐัะธัะฐะตั ะพั cross-site ะฐัะฐะบ, ะฝะพ ะฝะต ะพั ะฒัะตั ัะณัะพะท.

### Q: ะงัะพ ะดะตะปะฐัั ะตัะปะธ CDN ะฑะตะท CORS?

**A:**
1. ะะพะฟัะพัะธัั ะฒะปะฐะดะตะปััะฐ ะฒะบะปััะธัั CORS
2. ะัะฟะพะปัะทะพะฒะฐัั CORS proxy (ะตัะปะธ ัะฐะฑะพัะฐะตั)
3. ะกะบะฐัะฐัั ะธะทะพะฑัะฐะถะตะฝะธั ะธ ััะฐะฝะธัั ะปะพะบะฐะปัะฝะพ (base64)
4. ะัะฟะพะปัะทะพะฒะฐัั ะดััะณะพะน CDN ั CORS

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [MDN: CORS](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS)
- [Figma Plugin API](https://www.figma.com/plugin-docs/)
- [What is CORS?](https://www.codecademy.com/article/what-is-cors)

---

## ๐ฏ ะัะพะณ ะดะปั ะฝะฐัะตะณะพ ะฟะปะฐะณะธะฝะฐ

### ะงัะพ ะผั ัะทะฝะฐะปะธ:

1. โ CORS โ ััะพ ะผะตัะฐะฝะธะทะผ ะฑะตะทะพะฟะฐัะฝะพััะธ
2. โ ะฏะฝะดะตะบั CDN ะฟะพะดะดะตัะถะธะฒะฐะตั CORS ะธะท ะบะพัะพะฑะบะธ
3. โ ะะฐะผ ะฝะต ะฝัะถะตะฝ CORS proxy
4. โ ะะทะพะฑัะฐะถะตะฝะธั ะทะฐะณััะถะฐัััั ะฝะฐะฟััะผัั ะธ ะฑััััะพ
5. โ ะะฐะฑะพัะฐะตั ะธะท ะะพััะธะธ ะธ ะฒัะตั ะดััะณะธั ัััะฐะฝ

### ะัะฒะพะด:

**CORS proxy ะฑัะป ะธะทะปะธัะฝะธะผ ััะปะพะถะฝะตะฝะธะตะผ!** ะฏะฝะดะตะบั CDN ัะถะต ะฝะฐัััะพะตะฝ ะฟัะฐะฒะธะปัะฝะพ, ะฟะพััะพะผั ะฝะฐั ะฟะปะฐะณะธะฝ ัะฐะฑะพัะฐะตั ะพัะปะธัะฝะพ ะฑะตะท ะดะพะฟะพะปะฝะธัะตะปัะฝัั ะบะพัััะปะตะน.

---

## ๐ ะะธะทัะฐะปัะฝะฐั ััะตะผะฐ

```
ะะะ CORS:
โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
โ Figma Plugin โ โโโโโโ โ CDN (no CORS)โ
โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
                              โ
                    ะัะธะฑะบะฐ: CORS policy


ะก CORS:
โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ
โ Figma Plugin โ โโโโโโ โ ะฏะฝะดะตะบั CDN  โ
โโโโโโโโโโโโโโโโ         โ (with CORS) โ
                         โโโโโโโโโโโโโโโ
                              โ
                    โ ะะทะพะฑัะฐะถะตะฝะธะต ะทะฐะณััะถะตะฝะพ!


ะก CORS PROXY (ะฝะตะฝัะถะฝัะน ะฟััั):
โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ Figma Plugin โโโโ โ CORS Proxy   โโโโ โ ะฏะฝะดะตะบั CDN  โ
โโโโโโโโโโโโโโโโ    โ (corsproxy)  โ    โ (with CORS) โ
                    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
                         โ
                    โ๏ธ ะะตะดะปะตะฝะฝะพ, ะฝะตะฝะฐะดะตะถะฝะพ,
                       ะผะพะถะตั ะฑััั ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ
```

---

**ะะพัะฐะปั:** ะัะตะณะดะฐ ะฟัะพะฒะตััะนัะต, ะฟะพะดะดะตัะถะธะฒะฐะตั ะปะธ CDN CORS, ะฟัะตะถะดะต ัะตะผ ะดะพะฑะฐะฒะปััั ัะปะพะถะฝัะต ะพะฑัะพะดะฝัะต ะฟััะธ! ๐
